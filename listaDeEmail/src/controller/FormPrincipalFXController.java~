package controller;

import java.io.File;
import java.io.FileInputStream;

import javax.swing.JOptionPane;

import javafx.fxml.FXML;
import javafx.scene.control.Alert;
import javafx.scene.control.Alert.AlertType;
import javafx.stage.FileChooser;
import jidefx.scene.control.field.DateField;
import jidefx.scene.control.field.FormattedTextField;
import jidefx.scene.control.field.verifier.IntegerRangePatternVerifier;
import util.ExcelHelper;
import util.GeradorDeEmail;

public class FormPrincipalFXController {

	FileChooser fileChooser = new FileChooser();

	File arquivo;
	
	@FXML
	private FormattedTextField<String> formattedTextFieldTurma;

	@FXML
	private DateField dateFieldData;

	private FileInputStream inputStream;

	@FXML
	public void onSelecionaPlanilha() {

		this.configureFileChooser();
		
		Alert mensagem;
		
		try {
			this.inputStream = new FileInputStream(arquivo.getAbsolutePath());
			
			
			final ExcelHelper excel = new ExcelHelper(this.inputStream);
			
			final GeradorDeEmail gerador = new GeradorDeEmail();

		//	gerador.geraEmail(excel.getListaDeEmpregados(), excel.getListaDeSr(), this.formattedTextFieldTurma.getText(), this.dateFieldData.getText());

			mostraMensagem(AlertType.INFORMATION, "");
			
		} catch (final Exception e) {
			
			e.printStackTrace();
			
			mensagem = new Alert(AlertType.ERROR);
			
			mensagem.setContentText(e.getMessage());
			
			mensagem.show();
			
		}

	}

	private void mostraMensagem(AlertType tipo, String mensagem) {

		Alert mensagem;
		mensagem = new Alert(AlertType.INFORMATION);

		mensagem.setContentText("Mensagens enviadas com sucesso.");
		
		mensagem.show();
	}

	public void initialize() {

		// Colocando a mascara no campo turma para s√≥ permitir numeros de 0 a 999
		formattedTextFieldTurma.setPattern("nn");
	
		formattedTextFieldTurma.getPatternVerifiers().put("nn", new IntegerRangePatternVerifier(0, 999));

	}

	private void configureFileChooser() {

		fileChooser.setInitialDirectory(new File(System.getProperty("user.home")));

		fileChooser.getExtensionFilters().add(new FileChooser.ExtensionFilter("Planilha Excel 2003 (.xls)", "*.xls"));

		arquivo =  fileChooser.showOpenDialog(null);
	}
}
